<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=50710&amp;path=livereload" data-no-instant defer></script>
  <title>
  Mastering Bulk RNA-seq Analysis – Post 4: Experimental Design &amp; Count Matrix Setup · Badran Elshenawy
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Badran Elshenawy">
<meta name="description" content="Master the art of experimental design in DESeq2 analysis. Learn how to construct design formulas that accurately translate your biological questions into statistical language, handle batch effects, and avoid common pitfalls.">
<meta name="keywords" content="[bioinformatics data science linux command-line HPC automation]">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Mastering Bulk RNA-seq Analysis – Post 4: Experimental Design & Count Matrix Setup">
  <meta name="twitter:description" content="Master the art of experimental design in DESeq2 analysis. Learn how to construct design formulas that accurately translate your biological questions into statistical language, handle batch effects, and avoid common pitfalls.">

<meta property="og:url" content="http://localhost:50710/posts/experimental-design-count-matrix/">
  <meta property="og:site_name" content="Badran Elshenawy">
  <meta property="og:title" content="Mastering Bulk RNA-seq Analysis – Post 4: Experimental Design & Count Matrix Setup">
  <meta property="og:description" content="Master the art of experimental design in DESeq2 analysis. Learn how to construct design formulas that accurately translate your biological questions into statistical language, handle batch effects, and avoid common pitfalls.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-07-31T09:30:00+00:00">
    <meta property="article:modified_time" content="2025-07-31T09:30:00+00:00">
    <meta property="article:tag" content="DESeq2">
    <meta property="article:tag" content="RNA-Seq">
    <meta property="article:tag" content="Experimental Design">
    <meta property="article:tag" content="Design Formula">
    <meta property="article:tag" content="Batch Effects">
    <meta property="article:tag" content="Statistical Modeling">




<link rel="canonical" href="http://localhost:50710/posts/experimental-design-count-matrix/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:50710/">
      Badran Elshenawy
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:50710/posts/experimental-design-count-matrix/">
              Mastering Bulk RNA-seq Analysis – Post 4: Experimental Design &amp; Count Matrix Setup
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2025-07-31T09:30:00Z">
                July 31, 2025
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              6-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/bioinformatics/">Bioinformatics</a>
      <span class="separator">•</span>
    <a href="/categories/r/">R</a>
      <span class="separator">•</span>
    <a href="/categories/rna-seq/">RNA-Seq</a>
      <span class="separator">•</span>
    <a href="/categories/experimental-design/">Experimental Design</a>
      <span class="separator">•</span>
    <a href="/categories/statistics/">Statistics</a></div>

          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/deseq2/">DESeq2</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/rna-seq/">RNA-Seq</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/experimental-design/">Experimental Design</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/design-formula/">Design Formula</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/batch-effects/">Batch Effects</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/statistical-modeling/">Statistical Modeling</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/sample-size/">Sample Size</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/factorial-design/">Factorial Design</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/paired-samples/">Paired Samples</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/gene-expression-analysis/">Gene Expression Analysis</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <h1 id="-mastering-bulk-rna-seq-analysis-in-r----post-4-experimental-design--count-matrix-setup">
  🧬 Mastering Bulk RNA-seq Analysis in R &ndash; Post 4: Experimental Design &amp; Count Matrix Setup
  <a class="heading-link" href="#-mastering-bulk-rna-seq-analysis-in-r----post-4-experimental-design--count-matrix-setup">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<h2 id="-why-design-formulas-make-or-break-your-analysis">
  🎯 Why Design Formulas Make or Break Your Analysis
  <a class="heading-link" href="#-why-design-formulas-make-or-break-your-analysis">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Here&rsquo;s a truth that catches many researchers off guard: <strong>The most common place RNA-seq analyses go wrong isn&rsquo;t in the statistics&mdash;it&rsquo;s in how the biological question gets translated into statistical language.</strong></p>
<p>Your design formula is the blueprint that tells DESeq2 exactly what biological questions you want answered and how to account for the messy realities of experimental biology. Get this right, and DESeq2 will give you reliable, interpretable results. Get it wrong, and even perfect wet lab work won&rsquo;t save your analysis.</p>
<p>The good news? Once you understand the logic behind design formulas, choosing the right one becomes intuitive.</p>
<hr>
<h2 id="-design-formula-fundamentals">
  🧠 Design Formula Fundamentals
  <a class="heading-link" href="#-design-formula-fundamentals">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>The design formula serves three critical functions:</p>
<ol>
<li><strong>Identifies factors that affect gene expression</strong> (treatment, genotype, batch, etc.)</li>
<li><strong>Specifies what comparisons you want to make</strong> (treated vs control)</li>
<li><strong>Controls for confounding variables</strong> (batch effects, patient differences)</li>
</ol>
<p>The general pattern is: <code>design = ~ confounding_factors + biological_factors</code></p>
<hr>
<h2 id="-common-experimental-designs">
  🔬 Common Experimental Designs
  <a class="heading-link" href="#-common-experimental-designs">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h3 id="1-simple-two-group-comparison">
  1. Simple Two-Group Comparison
  <a class="heading-link" href="#1-simple-two-group-comparison">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><strong>Scenario</strong>: Comparing treated vs control samples</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Design formula</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">condition</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># What this tests</span>
</span></span><span class="line"><span class="cl"><span class="n">treated_vs_control</span> <span class="o">&lt;-</span> <span class="nf">results</span><span class="p">(</span><span class="n">dds</span><span class="p">,</span> <span class="n">contrast</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;condition&#34;</span><span class="p">,</span> <span class="s">&#34;treated&#34;</span><span class="p">,</span> <span class="s">&#34;control&#34;</span><span class="p">))</span>
</span></span></code></pre></div><p><strong>When to use</strong>: Clean experiments with one factor of interest and good experimental controls.</p>
<h3 id="2-multiple-conditions">
  2. Multiple Conditions
  <a class="heading-link" href="#2-multiple-conditions">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><strong>Scenario</strong>: Testing multiple treatments against a control</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Design formula</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">treatment</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Possible comparisons</span>
</span></span><span class="line"><span class="cl"><span class="n">drugA_vs_control</span> <span class="o">&lt;-</span> <span class="nf">results</span><span class="p">(</span><span class="n">dds</span><span class="p">,</span> <span class="n">contrast</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;treatment&#34;</span><span class="p">,</span> <span class="s">&#34;drugA&#34;</span><span class="p">,</span> <span class="s">&#34;control&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">drugB_vs_control</span> <span class="o">&lt;-</span> <span class="nf">results</span><span class="p">(</span><span class="n">dds</span><span class="p">,</span> <span class="n">contrast</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;treatment&#34;</span><span class="p">,</span> <span class="s">&#34;drugB&#34;</span><span class="p">,</span> <span class="s">&#34;control&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">drugA_vs_drugB</span> <span class="o">&lt;-</span> <span class="nf">results</span><span class="p">(</span><span class="n">dds</span><span class="p">,</span> <span class="n">contrast</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;treatment&#34;</span><span class="p">,</span> <span class="s">&#34;drugA&#34;</span><span class="p">,</span> <span class="s">&#34;drugB&#34;</span><span class="p">))</span>
</span></span></code></pre></div><p><strong>When to use</strong>: Dose-response studies, multiple drug comparisons, time course experiments.</p>
<h3 id="3-pairedmatched-samples">
  3. Paired/Matched Samples
  <a class="heading-link" href="#3-pairedmatched-samples">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><strong>Scenario</strong>: Before/after treatment in the same patients</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Design formula</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">patient</span> <span class="o">+</span> <span class="n">condition</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># What this does</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Controls for patient-to-patient differences, focuses on treatment effect</span>
</span></span></code></pre></div><p><strong>When to use</strong>: Clinical studies with matched samples, longitudinal designs, any situation where you can pair samples.</p>
<p><strong>Power boost</strong>: This design dramatically increases statistical power by removing inter-individual variation.</p>
<h3 id="4-batch-effects">
  4. Batch Effects
  <a class="heading-link" href="#4-batch-effects">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><strong>Scenario</strong>: Samples processed on different days or by different people</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Design formula</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">condition</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># What this does</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Accounts for technical variation while testing biological effects</span>
</span></span></code></pre></div><p><strong>When to use</strong>: Almost always! Batch effects are incredibly common and often invisible until you look for them.</p>
<h3 id="5-factorial-design">
  5. Factorial Design
  <a class="heading-link" href="#5-factorial-design">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><strong>Scenario</strong>: Testing interactions between factors</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Design formula</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">genotype</span> <span class="o">+</span> <span class="n">treatment</span> <span class="o">+</span> <span class="n">genotype</span><span class="o">:</span><span class="n">treatment</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># What this tests</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - Main effect of genotype</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - Main effect of treatment  </span>
</span></span><span class="line"><span class="cl"><span class="c1"># - Interaction: does treatment work differently in different genotypes?</span>
</span></span></code></pre></div><p><strong>When to use</strong>: When you specifically want to test whether factors interact (e.g., does a drug work differently in males vs females?).</p>
<hr>
<h2 id="-design-formula-rules-of-thumb">
  💡 Design Formula Rules of Thumb
  <a class="heading-link" href="#-design-formula-rules-of-thumb">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h3 id="order-matters">
  Order Matters
  <a class="heading-link" href="#order-matters">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Always put technical/confounding variables <strong>first</strong> and biological variables of interest <strong>last</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Correct</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">sex</span> <span class="o">+</span> <span class="n">treatment</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Incorrect  </span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">treatment</span> <span class="o">+</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">sex</span>
</span></span></code></pre></div><p>This ensures DESeq2 properly accounts for confounders before testing your biological effects.</p>
<h3 id="keep-it-simple">
  Keep It Simple
  <a class="heading-link" href="#keep-it-simple">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Your design complexity should match your sample size:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Simple design: OK with 3-4 replicates per group</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">condition</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Complex design: Need 6+ replicates per combination</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">genotype</span> <span class="o">+</span> <span class="n">treatment</span> <span class="o">+</span> <span class="n">genotype</span><span class="o">:</span><span class="n">treatment</span>
</span></span></code></pre></div><p><strong>Rule of thumb</strong>: Each factor level should have at least 3 biological replicates, preferably 5+.</p>
<hr>
<h2 id="-sample-size-guidelines">
  📊 Sample Size Guidelines
  <a class="heading-link" href="#-sample-size-guidelines">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<table>
  <thead>
      <tr>
          <th>Design Type</th>
          <th>Minimum per Group</th>
          <th>Recommended</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Simple (~ condition)</td>
          <td>3</td>
          <td>5-6</td>
      </tr>
      <tr>
          <td>With batch (~ batch + condition)</td>
          <td>3</td>
          <td>4-5</td>
      </tr>
      <tr>
          <td>Factorial (~ A + B + A:B)</td>
          <td>3 per combination</td>
          <td>5-6 per combination</td>
      </tr>
      <tr>
          <td>Time course (~ time)</td>
          <td>3 per timepoint</td>
          <td>4-5 per timepoint</td>
      </tr>
  </tbody>
</table>
<p><strong>Remember</strong>: More replicates = more statistical power = more confident results.</p>
<hr>
<h2 id="-count-matrix-best-practices">
  ✅ Count Matrix Best Practices
  <a class="heading-link" href="#-count-matrix-best-practices">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h3 id="pre-filtering-low-count-genes">
  Pre-filtering Low-Count Genes
  <a class="heading-link" href="#pre-filtering-low-count-genes">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Remove genes with very low expression</span>
</span></span><span class="line"><span class="cl"><span class="n">keep</span> <span class="o">&lt;-</span> <span class="nf">rowSums</span><span class="p">(</span><span class="nf">counts</span><span class="p">(</span><span class="n">dds</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="n">dds_filtered</span> <span class="o">&lt;-</span> <span class="n">dds[keep</span><span class="p">,</span> <span class="n">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check the impact</span>
</span></span><span class="line"><span class="cl"><span class="nf">cat</span><span class="p">(</span><span class="s">&#34;Genes before filtering:&#34;</span><span class="p">,</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">dds</span><span class="p">),</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">cat</span><span class="p">(</span><span class="s">&#34;Genes after filtering:&#34;</span><span class="p">,</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">dds_filtered</span><span class="p">),</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><strong>Why this helps</strong>: Improves statistical power and reduces multiple testing burden.</p>
<h3 id="factor-level-management">
  Factor Level Management
  <a class="heading-link" href="#factor-level-management">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>The reference level determines how comparisons are interpreted:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Check current levels</span>
</span></span><span class="line"><span class="cl"><span class="nf">levels</span><span class="p">(</span><span class="n">dds</span><span class="o">$</span><span class="n">condition</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Set reference level (the &#34;control&#34; in your comparison)</span>
</span></span><span class="line"><span class="cl"><span class="n">dds</span><span class="o">$</span><span class="n">condition</span> <span class="o">&lt;-</span> <span class="nf">relevel</span><span class="p">(</span><span class="n">dds</span><span class="o">$</span><span class="n">condition</span><span class="p">,</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">&#34;control&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Verify the change</span>
</span></span><span class="line"><span class="cl"><span class="nf">levels</span><span class="p">(</span><span class="n">dds</span><span class="o">$</span><span class="n">condition</span><span class="p">)</span>  <span class="c1"># &#34;control&#34; should be first</span>
</span></span></code></pre></div><p><strong>Critical point</strong>: This determines whether positive fold changes mean &ldquo;up in treatment&rdquo; or &ldquo;up in control&rdquo;!</p>
<hr>
<h2 id="-common-design-mistakes">
  ⚠️ Common Design Mistakes
  <a class="heading-link" href="#-common-design-mistakes">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h3 id="1-ignoring-batch-effects">
  1. Ignoring Batch Effects
  <a class="heading-link" href="#1-ignoring-batch-effects">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><strong>Problem</strong>: Samples processed at different times often cluster by processing date rather than biological condition.</p>
<p><strong>Solution</strong>: Always include batch information when available:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">condition</span>
</span></span></code></pre></div><h3 id="2-overly-complex-designs">
  2. Overly Complex Designs
  <a class="heading-link" href="#2-overly-complex-designs">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><strong>Problem</strong>: Including too many factors or interactions with insufficient sample sizes.</p>
<p><strong>Solution</strong>: Start simple and add complexity only when justified:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Start here</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">condition</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Add batch if needed</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">condition</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Add interactions only if specifically testing them</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">condition</span> <span class="o">+</span> <span class="n">batch</span><span class="o">:</span><span class="n">condition</span>
</span></span></code></pre></div><h3 id="3-wrong-reference-levels">
  3. Wrong Reference Levels
  <a class="heading-link" href="#3-wrong-reference-levels">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><strong>Problem</strong>: DESeq2 uses alphabetical order by default, which may not be your intended control.</p>
<p><strong>Solution</strong>: Always set reference levels explicitly:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># This ensures &#34;control&#34; is your reference, not whatever comes first alphabetically</span>
</span></span><span class="line"><span class="cl"><span class="n">dds</span><span class="o">$</span><span class="n">condition</span> <span class="o">&lt;-</span> <span class="nf">relevel</span><span class="p">(</span><span class="n">dds</span><span class="o">$</span><span class="n">condition</span><span class="p">,</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">&#34;control&#34;</span><span class="p">)</span>
</span></span></code></pre></div><hr>
<h2 id="-real-world-examples">
  🔬 Real-World Examples
  <a class="heading-link" href="#-real-world-examples">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h3 id="time-course-study">
  Time Course Study
  <a class="heading-link" href="#time-course-study">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Design</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample structure needed</span>
</span></span><span class="line"><span class="cl"><span class="c1"># time1: 5 replicates</span>
</span></span><span class="line"><span class="cl"><span class="c1"># time2: 5 replicates  </span>
</span></span><span class="line"><span class="cl"><span class="c1"># time3: 5 replicates</span>
</span></span><span class="line"><span class="cl"><span class="c1"># etc.</span>
</span></span></code></pre></div><h3 id="clinical-trial-with-batch-effects">
  Clinical Trial with Batch Effects
  <a class="heading-link" href="#clinical-trial-with-batch-effects">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Design</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">sex</span> <span class="o">+</span> <span class="n">treatment</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># What this controls for</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - Technical variation (batch)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - Biological confounders (sex)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - Tests treatment effect</span>
</span></span></code></pre></div><h3 id="drug-combination-study">
  Drug Combination Study
  <a class="heading-link" href="#drug-combination-study">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Design</span>
</span></span><span class="line"><span class="cl"><span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">drugA</span> <span class="o">+</span> <span class="n">drugB</span> <span class="o">+</span> <span class="n">drugA</span><span class="o">:</span><span class="n">drugB</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># What this tests</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - Effect of drug A alone</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - Effect of drug B alone</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - Synergistic/antagonistic effects (interaction)</span>
</span></span></code></pre></div><hr>
<h2 id="-putting-it-all-together">
  🎯 Putting It All Together
  <a class="heading-link" href="#-putting-it-all-together">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Here&rsquo;s a complete workflow for setting up your experimental design:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 1. Load your data (from previous post)</span>
</span></span><span class="line"><span class="cl"><span class="n">dds</span> <span class="o">&lt;-</span> <span class="nf">DESeqDataSetFromMatrix</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">colData</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. Examine your experimental factors</span>
</span></span><span class="line"><span class="cl"><span class="nf">table</span><span class="p">(</span><span class="n">dds</span><span class="o">$</span><span class="n">condition</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">table</span><span class="p">(</span><span class="n">dds</span><span class="o">$</span><span class="n">batch</span><span class="p">)</span>  <span class="c1"># if applicable</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 3. Set reference levels</span>
</span></span><span class="line"><span class="cl"><span class="n">dds</span><span class="o">$</span><span class="n">condition</span> <span class="o">&lt;-</span> <span class="nf">relevel</span><span class="p">(</span><span class="n">dds</span><span class="o">$</span><span class="n">condition</span><span class="p">,</span> <span class="n">ref</span> <span class="o">=</span> <span class="s">&#34;control&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 4. Choose appropriate design formula</span>
</span></span><span class="line"><span class="cl"><span class="nf">design</span><span class="p">(</span><span class="n">dds</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="o">~</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">condition</span>  <span class="c1"># adjust as needed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 5. Pre-filter low-count genes</span>
</span></span><span class="line"><span class="cl"><span class="n">keep</span> <span class="o">&lt;-</span> <span class="nf">rowSums</span><span class="p">(</span><span class="nf">counts</span><span class="p">(</span><span class="n">dds</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="n">dds</span> <span class="o">&lt;-</span> <span class="n">dds[keep</span><span class="p">,</span> <span class="n">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 6. Verify everything looks correct</span>
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">dds</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="nf">design</span><span class="p">(</span><span class="n">dds</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="nf">levels</span><span class="p">(</span><span class="n">dds</span><span class="o">$</span><span class="n">condition</span><span class="p">))</span>
</span></span></code></pre></div><p>You&rsquo;re now ready for the DESeq2 analysis pipeline!</p>
<hr>
<h2 id="-whats-next">
  🧪 What&rsquo;s Next?
  <a class="heading-link" href="#-whats-next">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p><strong>Post 5: Normalization and Transformation Methods</strong> will dive into how DESeq2 makes your samples comparable through size factor normalization and variance stabilizing transformations. We&rsquo;ll explore why raw counts can&rsquo;t be compared directly and how DESeq2&rsquo;s approach ensures robust results.</p>
<p>Get ready to understand the mathematical magic that happens before differential expression testing! 📈</p>
<hr>
<h2 id="-share-your-thoughts">
  💬 Share Your Thoughts!
  <a class="heading-link" href="#-share-your-thoughts">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>What&rsquo;s the most complex experimental design you&rsquo;ve had to analyze? Any tricky batch effect situations? Drop a comment below! 👇</p>
<p>#DESeq2 #ExperimentalDesign #RNAseq #Bioinformatics #StatisticalModeling #GeneExpression #BulkRNAseq #DataAnalysis #ComputationalBiology #RStats</p>

      </div>


      <footer>
        


        
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2025
     Badran Elshenawy 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
